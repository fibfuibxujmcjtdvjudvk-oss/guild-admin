import{_ as t,g as a,r as s,z as e,t as i,l as o,s as l,j as n,k as c,c as d,w as r,i as u,o as g,b as m,e as h,p as f,d as p,v as _,x as y,F as b,q as I,f as v,h as w,y as C}from"./index-DQwZrAFq.js";import{_ as k}from"./fanhui.DrUZnYcd.js";import{_ as S}from"./xingguangzhi.j0H7SwCr.js";const G=t({data:()=>({adminInfo:null,guildStarlight:0,currentCategory:"all",goodsList:[]}),computed:{filteredGoods(){return"all"===this.currentCategory?this.goodsList:this.goodsList.filter((t=>t.category===this.currentCategory))}},onLoad(){this.checkLogin()},onShow(){this.adminInfo&&this.loadShopData()},methods:{checkLogin(){const t=a("guild_admin_info");t&&t.guildId?(this.adminInfo=t,this.loadShopData()):s({url:"/pages/guild-admin/login/login"})},goBack(){e()},formatNumber:t=>t>=1e4?(t/1e4).toFixed(1)+"w":t.toString(),async loadShopData(){await this.loadStarlight(),await this.loadShopItems()},async loadStarlight(){var t;try{const a=await i.callFunction({name:"guild-center",data:{action:"getGuildStats",guildId:this.adminInfo.guildDbId||this.adminInfo.guildId}});0===(null==(t=a.result)?void 0:t.code)&&(this.guildStarlight=a.result.data.totalStarlight||0)}catch(a){console.error("è·å–æ˜Ÿå…‰å€¼å¤±è´¥:",a)}},async loadShopItems(){var t;try{const a=await i.callFunction({name:"guild-center",data:{action:"getShopItems",guildId:this.adminInfo.guildDbId||this.adminInfo.guildId}});0===(null==(t=a.result)?void 0:t.code)&&(this.goodsList=a.result.data.items.map((t=>({id:t.id,name:t.name,description:t.description,price:t.price,category:t.id.includes("card")?"props":"privilege",image:t.icon,owned:t.owned||0}))))}catch(a){console.error("åŠ è½½å•†åŸæ•°æ®å¤±è´¥:",a),this.goodsList=[{id:"rename_card",name:"å…¬ä¼šæ”¹åå¡",description:"å¯ä¿®æ”¹å…¬ä¼šåç§°ä¸€æ¬¡ï¼Œ30å¤©å†…åªèƒ½ä½¿ç”¨ä¸€æ¬¡",price:1e4,category:"props",image:"/static/gonghuihoutai/gonghuishangcheng/gonghuigaiming.png",owned:0},{id:"avatar_card",name:"å…¬ä¼šæ”¹å¤´åƒå¡",description:"å¯ä¿®æ”¹å…¬ä¼šå¤´åƒä¸€æ¬¡ï¼Œ30å¤©å†…åªèƒ½ä½¿ç”¨ä¸€æ¬¡",price:1e4,category:"props",image:"/static/gonghuihoutai/gonghuishangcheng/gonghuigaitouxiang.png",owned:0}]}},showGoodsDetail(t){const a=t.owned>0?`\nå·²æ‹¥æœ‰: ${t.owned}å¼ `:"";o({title:t.name,content:t.description+"\n\nä»·æ ¼: "+this.formatNumber(t.price)+" æ˜Ÿå…‰å€¼"+a,confirmText:"è´­ä¹°",success:a=>{a.confirm&&this.buyGoods(t)}})},async buyGoods(t){this.guildStarlight<t.price?l({title:"æ˜Ÿå…‰å€¼ä¸è¶³",icon:"none"}):o({title:"ç¡®è®¤è´­ä¹°",content:`ç¡®å®šä½¿ç”¨ ${this.formatNumber(t.price)} æ˜Ÿå…‰å€¼è´­ä¹°ã€Œ${t.name}ã€å—ï¼Ÿ`,success:async a=>{var s,e;if(a.confirm)try{n({title:"è´­ä¹°ä¸­..."});const a=await i.callFunction({name:"guild-center",data:{action:"buyGuildItem",guildId:this.adminInfo.guildDbId||this.adminInfo.guildId,itemType:t.id,quantity:1}});if(c(),0===(null==(s=a.result)?void 0:s.code)){this.guildStarlight=a.result.data.remainingStarlight;const s=this.goodsList.find((a=>a.id===t.id));s&&(s.owned=(s.owned||0)+1),l({title:"è´­ä¹°æˆåŠŸ",icon:"success"})}else l({title:(null==(e=a.result)?void 0:e.message)||"è´­ä¹°å¤±è´¥",icon:"none"})}catch(o){c(),console.error("è´­ä¹°å¤±è´¥:",o),l({title:"è´­ä¹°å¤±è´¥",icon:"none"})}}})}}},[["render",function(t,a,s,e,i,o){const l=v,n=u,c=w;return g(),d(n,{class:"shop-page"},{default:r((()=>[m(n,{class:"nav-header"},{default:r((()=>[m(n,{class:"nav-left",onClick:o.goBack},{default:r((()=>[m(l,{src:k,class:"back-button",mode:"aspectFit"})])),_:1},8,["onClick"]),m(c,{class:"nav-title"},{default:r((()=>[h("å…¬ä¼šå•†åº—")])),_:1}),m(n,{class:"nav-right"})])),_:1}),m(n,{class:"points-card"},{default:r((()=>[m(n,{class:"points-info"},{default:r((()=>[m(l,{class:"starlight-icon",src:S,mode:"aspectFit"}),m(c,{class:"points-label"},{default:r((()=>[h("å…¬ä¼šæ˜Ÿå…‰å€¼")])),_:1}),m(c,{class:"points-value"},{default:r((()=>[h(f(o.formatNumber(i.guildStarlight)),1)])),_:1})])),_:1}),m(n,{class:"points-hint"},{default:r((()=>[m(c,null,{default:r((()=>[h("æˆå‘˜å®Œæˆè®¢å•å¯è·å¾—æ˜Ÿå…‰å€¼")])),_:1})])),_:1})])),_:1}),m(n,{class:"category-tabs"},{default:r((()=>[m(n,{class:p(["tab-item",{active:"all"===i.currentCategory}]),onClick:a[0]||(a[0]=t=>i.currentCategory="all")},{default:r((()=>[h(" å…¨éƒ¨ ")])),_:1},8,["class"]),m(n,{class:p(["tab-item",{active:"props"===i.currentCategory}]),onClick:a[1]||(a[1]=t=>i.currentCategory="props")},{default:r((()=>[h(" é“å…· ")])),_:1},8,["class"]),m(n,{class:p(["tab-item",{active:"privilege"===i.currentCategory}]),onClick:a[2]||(a[2]=t=>i.currentCategory="privilege")},{default:r((()=>[h(" ç‰¹æƒ ")])),_:1},8,["class"]),m(n,{class:p(["tab-item",{active:"decoration"===i.currentCategory}]),onClick:a[3]||(a[3]=t=>i.currentCategory="decoration")},{default:r((()=>[h(" è£…é¥° ")])),_:1},8,["class"])])),_:1}),m(n,{class:"goods-list"},{default:r((()=>[(g(!0),_(b,null,y(o.filteredGoods,(t=>(g(),d(n,{class:"goods-item",key:t.id,onClick:a=>o.showGoodsDetail(t)},{default:r((()=>[m(l,{class:"goods-image",src:t.image,mode:"aspectFit"},null,8,["src"]),m(n,{class:"goods-info"},{default:r((()=>[m(c,{class:"goods-name"},{default:r((()=>[h(f(t.name),1)])),_:2},1024),m(c,{class:"goods-desc"},{default:r((()=>[h(f(t.description),1)])),_:2},1024),m(n,{class:"goods-bottom"},{default:r((()=>[m(n,{class:"goods-price"},{default:r((()=>[m(l,{class:"price-icon",src:S,mode:"aspectFit"}),m(c,null,{default:r((()=>[h(f(o.formatNumber(t.price)),1)])),_:2},1024)])),_:2},1024),t.owned>0?(g(),d(n,{key:0,class:"owned-info"},{default:r((()=>[m(c,null,{default:r((()=>[h("å·²æœ‰ "+f(t.owned),1)])),_:2},1024)])),_:2},1024)):I("",!0),m(n,{class:"buy-btn",onClick:C((a=>o.buyGoods(t)),["stop"])},{default:r((()=>[m(c,null,{default:r((()=>[h("è´­ä¹°")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===o.filteredGoods.length?(g(),d(n,{key:0,class:"empty-state"},{default:r((()=>[m(c,{class:"empty-icon"},{default:r((()=>[h("ğŸ›’")])),_:1}),m(c,{class:"empty-text"},{default:r((()=>[h("æš‚æ— å•†å“")])),_:1})])),_:1})):I("",!0)])),_:1}),m(n,{class:"safe-bottom"})])),_:1})}],["__scopeId","data-v-eebd9fcc"]]);export{G as default};
