import{_ as a,g as t,r as l,z as n,t as e,j as s,k as i,s as o,c,w as d,i as m,o as u,b as r,e as f,v as p,x as g,F as _,f as h,h as C,p as I}from"./index-DQwZrAFq.js";import{_ as k}from"./fanhui.DrUZnYcd.js";const v=a({data:()=>({adminInfo:null,pendingComplaints:[],loading:!1}),onLoad(){this.checkLogin()},onShow(){this.adminInfo&&this.loadPendingComplaints()},methods:{checkLogin(){const a=t("guild_admin_info");a&&a.guildId?(this.adminInfo=a,this.loadPendingComplaints()):l({url:"/pages/guild-admin/login/login"})},goBack(){n()},async loadPendingComplaints(){var a;try{this.loading=!0;const t=await e.callFunction({name:"guild-center",data:{action:"getPendingComplaints",guildId:this.adminInfo.guildDbId||this.adminInfo.guildId}});0===(null==(a=t.result)?void 0:a.code)&&(this.pendingComplaints=t.result.data.list||[])}catch(t){console.error("加载待处理投诉失败:",t)}finally{this.loading=!1}},formatTime(a){if(!a)return"";const t=new Date(a),l=new Date-t;return l<6e4?"刚刚":l<36e5?Math.floor(l/6e4)+"分钟前":l<864e5?Math.floor(l/36e5)+"小时前":l<6048e5?Math.floor(l/864e5)+"天前":`${t.getMonth()+1}/${t.getDate()}`},async handleComplaint(a,t){var l,n;try{s({title:t?"处理中...":"驳回中..."});const c=await e.callFunction({name:"guild-center",data:{action:"handleComplaint",guildId:this.adminInfo.guildDbId||this.adminInfo.guildId,complaintId:a._id,resolved:t}});i(),0===(null==(l=c.result)?void 0:l.code)?(o({title:t?"已处理":"已驳回",icon:"success"}),this.loadPendingComplaints()):o({title:(null==(n=c.result)?void 0:n.message)||"操作失败",icon:"none"})}catch(c){i(),console.error("处理投诉失败:",c),o({title:"操作失败",icon:"none"})}}}},[["render",function(a,t,l,n,e,s){const i=h,o=m,v=C;return u(),c(o,{class:"complaint-page"},{default:d((()=>[r(o,{class:"nav-header"},{default:d((()=>[r(o,{class:"nav-left",onClick:s.goBack},{default:d((()=>[r(i,{src:k,class:"back-button",mode:"aspectFit"})])),_:1},8,["onClick"]),r(v,{class:"nav-title"},{default:d((()=>[f("投诉处理")])),_:1}),r(o,{class:"nav-right"})])),_:1}),e.pendingComplaints.length>0?(u(),c(o,{key:0,class:"complaint-list"},{default:d((()=>[(u(!0),p(_,null,g(e.pendingComplaints,(a=>(u(),c(o,{class:"complaint-item",key:a._id},{default:d((()=>[r(o,{class:"complaint-header"},{default:d((()=>[r(i,{class:"complaint-avatar",src:a.complainant_avatar||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),r(o,{class:"complaint-user"},{default:d((()=>[r(v,{class:"complaint-name"},{default:d((()=>[f(I(a.complainant_name||"用户"),1)])),_:2},1024),r(v,{class:"complaint-time"},{default:d((()=>[f(I(s.formatTime(a.create_time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(o,{class:"complaint-target"},{default:d((()=>[r(v,{class:"target-label"},{default:d((()=>[f("被投诉人：")])),_:1}),r(v,{class:"target-name"},{default:d((()=>[f(I(a.target_name||"成员"),1)])),_:2},1024)])),_:2},1024),r(o,{class:"complaint-content"},{default:d((()=>[r(v,null,{default:d((()=>[f(I(a.content||"无投诉内容"),1)])),_:2},1024)])),_:2},1024),r(o,{class:"complaint-actions"},{default:d((()=>[r(o,{class:"action-btn reject",onClick:t=>s.handleComplaint(a,!1)},{default:d((()=>[r(v,null,{default:d((()=>[f("驳回")])),_:1})])),_:2},1032,["onClick"]),r(o,{class:"action-btn accept",onClick:t=>s.handleComplaint(a,!0)},{default:d((()=>[r(v,null,{default:d((()=>[f("处理")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(u(),c(o,{key:1,class:"empty-state"},{default:d((()=>[r(v,{class:"empty-icon"},{default:d((()=>[f("✨")])),_:1}),r(v,{class:"empty-text"},{default:d((()=>[f("暂无待处理投诉")])),_:1}),r(v,{class:"empty-desc"},{default:d((()=>[f("成员投诉将会显示在这里")])),_:1})])),_:1})),r(o,{class:"safe-bottom"})])),_:1})}],["__scopeId","data-v-f78bee0d"]]);export{v as default};
