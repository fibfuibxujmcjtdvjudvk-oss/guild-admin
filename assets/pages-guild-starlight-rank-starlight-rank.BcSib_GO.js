import{_ as a,B as t,g as s,t as e,s as l,n as i,z as n,C as d,c as r,w as c,i as o,o as u,b as f,e as h,u as g,p as m,q as _,d as k,v as b,x as p,F as y,f as v,h as I}from"./index-DQwZrAFq.js";import{_ as w}from"./fanhui.DrUZnYcd.js";const x=a({data:()=>({statusBarHeight:0,navBarHeight:0,userId:"",guildId:"",currentTab:"total",loading:!1,hasMore:!0,page:1,pageSize:20,rankList:[],myRank:null,guildInfo:{name:"",avatar:"",memberCount:0,totalStarlight:0}}),computed:{tabIndicatorLeft(){return{weekly:"16.67%",monthly:"50%",total:"83.33%"}[this.currentTab]||"83.33%"}},onLoad(){const a=t();this.statusBarHeight=a.statusBarHeight||0;const e=88*a.windowWidth/750;this.navBarHeight=this.statusBarHeight+e;const l=s("userInfo");if(l&&l._id)this.userId=l._id;else{const a=s("guild_admin_info");a&&a.userId&&(this.userId=a.userId)}this.loadRankData()},methods:{switchTab(a){this.currentTab!==a&&(this.currentTab=a,this.page=1,this.rankList=[],this.hasMore=!0,this.loadRankData())},async loadRankData(){var a,t;if(!this.loading)try{this.loading=!0;const s=await e.callFunction({name:"guild-center",data:{action:"getMemberStarlightRank",userId:this.userId,rankType:this.currentTab,page:this.page,pageSize:this.pageSize}});if(console.log("æ˜Ÿå…‰æŽ’åæ•°æ®:",s),0===(null==(a=null==s?void 0:s.result)?void 0:a.code)){const a=s.result.data;1===this.page?(this.rankList=a.list||[],this.guildInfo=a.guildInfo||this.guildInfo):this.rankList=[...this.rankList,...a.list||[]],this.hasMore=(a.list||[]).length>=this.pageSize,this.myRank=a.myRank||null}else l({title:(null==(t=null==s?void 0:s.result)?void 0:t.message)||"åŠ è½½å¤±è´¥",icon:"none"}),this.rankList=[],this.hasMore=!1}catch(s){console.error("åŠ è½½æŽ’åå¤±è´¥:",s),l({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•",icon:"none"}),this.rankList=[],this.hasMore=!1}finally{this.loading=!1}},loadMore(){this.hasMore&&!this.loading&&(this.page++,this.loadRankData())},viewMemberProfile(a){(null==a?void 0:a.userId)&&i({url:`/pages/profile-detail/profile-detail?userId=${a.userId}`})},formatNumber:a=>a?a>=1e4?(a/1e4).toFixed(1)+"w":a>=1e3?(a/1e3).toFixed(1)+"k":String(a):"0",goBack(){n({fail:()=>{d({url:"/pages/profile/profile"})}})}}},[["render",function(a,t,s,e,l,i){const n=v,d=I,x=o;return u(),r(x,{class:"rank-page"},{default:c((()=>[f(x,{class:"nav-bar",style:g({paddingTop:l.statusBarHeight+"px"})},{default:c((()=>[f(x,{class:"nav-content"},{default:c((()=>[f(n,{src:w,class:"back-button",mode:"aspectFit",onClick:i.goBack},null,8,["onClick"]),f(x,{class:"nav-center"},{default:c((()=>[f(d,{class:"nav-title"},{default:c((()=>[h("å…¬ä¼šæˆå‘˜æ˜Ÿå…‰æ¦œ")])),_:1})])),_:1}),f(x,{class:"nav-right"})])),_:1})])),_:1},8,["style"]),f(x,{class:"content-wrapper",style:{paddingTop:"100px"}},{default:c((()=>[f(x,{class:"header-bg"},{default:c((()=>[f(x,{class:"bg-decoration"},{default:c((()=>[f(x,{class:"deco-star star-1"},{default:c((()=>[h("â­")])),_:1}),f(x,{class:"deco-star star-2"},{default:c((()=>[h("âœ¨")])),_:1}),f(x,{class:"deco-star star-3"},{default:c((()=>[h("ðŸŒŸ")])),_:1})])),_:1}),l.guildInfo.name?(u(),r(x,{key:0,class:"guild-header"},{default:c((()=>[f(n,{class:"guild-avatar",src:l.guildInfo.avatar,mode:"aspectFill"},null,8,["src"]),f(x,{class:"guild-info"},{default:c((()=>[f(d,{class:"guild-name"},{default:c((()=>[h(m(l.guildInfo.name),1)])),_:1}),f(d,{class:"guild-stats"},{default:c((()=>[h("å…±"+m(l.guildInfo.memberCount||0)+"åæˆå‘˜ Â· æ€»æ˜Ÿå…‰"+m(i.formatNumber(l.guildInfo.totalStarlight)),1)])),_:1})])),_:1})])),_:1})):_("",!0),f(x,{class:"tab-section"},{default:c((()=>[f(x,{class:"tab-container"},{default:c((()=>[f(x,{class:k(["tab-item",{active:"weekly"===l.currentTab}]),onClick:t[0]||(t[0]=a=>i.switchTab("weekly"))},{default:c((()=>[f(d,{class:"tab-icon"},{default:c((()=>[h("ðŸ“Š")])),_:1}),f(d,{class:"tab-text"},{default:c((()=>[h("å‘¨æ¦œ")])),_:1})])),_:1},8,["class"]),f(x,{class:k(["tab-item",{active:"monthly"===l.currentTab}]),onClick:t[1]||(t[1]=a=>i.switchTab("monthly"))},{default:c((()=>[f(d,{class:"tab-icon"},{default:c((()=>[h("ðŸ†")])),_:1}),f(d,{class:"tab-text"},{default:c((()=>[h("æœˆæ¦œ")])),_:1})])),_:1},8,["class"]),f(x,{class:k(["tab-item",{active:"total"===l.currentTab}]),onClick:t[2]||(t[2]=a=>i.switchTab("total"))},{default:c((()=>[f(d,{class:"tab-icon"},{default:c((()=>[h("ðŸ‘‘")])),_:1}),f(d,{class:"tab-text"},{default:c((()=>[h("æ€»æ¦œ")])),_:1})])),_:1},8,["class"]),f(x,{class:"tab-indicator",style:g({left:i.tabIndicatorLeft})},null,8,["style"])])),_:1})])),_:1})])),_:1}),f(x,{class:"rank-list-section"},{default:c((()=>[(u(!0),b(y,null,p(l.rankList,((a,t)=>(u(),r(x,{key:a.id,class:"rank-item",onClick:t=>i.viewMemberProfile(a)},{default:c((()=>[f(x,{class:k(["rank-num","rank-"+(t+1)])},{default:c((()=>[0===t?(u(),r(d,{key:0},{default:c((()=>[h("ðŸ¥‡")])),_:1})):1===t?(u(),r(d,{key:1},{default:c((()=>[h("ðŸ¥ˆ")])),_:1})):2===t?(u(),r(d,{key:2},{default:c((()=>[h("ðŸ¥‰")])),_:1})):(u(),r(d,{key:3},{default:c((()=>[h(m(t+1),1)])),_:2},1024))])),_:2},1032,["class"]),f(n,{class:"item-avatar",src:a.avatar,mode:"aspectFill"},null,8,["src"]),f(x,{class:"item-info"},{default:c((()=>[f(x,{class:"info-row"},{default:c((()=>[f(d,{class:"item-name"},{default:c((()=>[h(m(a.nickname),1)])),_:2},1024),"owner"===a.role?(u(),r(x,{key:0,class:"role-tag"},{default:c((()=>[f(d,{class:"tag-text"},{default:c((()=>[h("ä¼šé•¿")])),_:1})])),_:1})):"admin"===a.role?(u(),r(x,{key:1,class:"role-tag admin"},{default:c((()=>[f(d,{class:"tag-text"},{default:c((()=>[h("ç®¡ç†")])),_:1})])),_:1})):_("",!0)])),_:2},1024),f(x,{class:"info-sub"},{default:c((()=>[f(d,{class:"sub-text"},{default:c((()=>[h("å®Œæˆ"+m(a.completedOrders||0)+"å•",1)])),_:2},1024),f(d,{class:"sub-divider"},{default:c((()=>[h("Â·")])),_:1}),f(d,{class:"sub-text"},{default:c((()=>[h("å¥½è¯„çŽ‡"+m(a.goodRating||0)+"%",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(x,{class:"item-starlight"},{default:c((()=>[f(d,{class:"star-icon"},{default:c((()=>[h("â­")])),_:1}),f(d,{class:"starlight-num"},{default:c((()=>[h(m(i.formatNumber(a.starlight)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),l.loading||0!==l.rankList.length?_("",!0):(u(),r(x,{key:0,class:"empty-state"},{default:c((()=>[f(d,{class:"empty-icon"},{default:c((()=>[h("ðŸ‘¥")])),_:1}),f(d,{class:"empty-text"},{default:c((()=>[h("æš‚æ— æˆå‘˜æŽ’åæ•°æ®")])),_:1})])),_:1})),l.loading?(u(),r(x,{key:1,class:"loading-state"},{default:c((()=>[f(d,{class:"loading-text"},{default:c((()=>[h("åŠ è½½ä¸­...")])),_:1})])),_:1})):_("",!0)])),_:1}),f(x,{class:"safe-bottom"})])),_:1}),l.myRank?(u(),r(x,{key:0,class:"my-rank-card"},{default:c((()=>[f(x,{class:"my-rank-title"},{default:c((()=>[h("æˆ‘çš„æŽ’å")])),_:1}),f(x,{class:"my-rank-content"},{default:c((()=>[f(x,{class:"rank-num"},{default:c((()=>[h(m(l.myRank.rank||"--"),1)])),_:1}),f(n,{class:"item-avatar",src:l.myRank.avatar,mode:"aspectFill"},null,8,["src"]),f(x,{class:"item-info"},{default:c((()=>[f(d,{class:"item-name"},{default:c((()=>[h(m(l.myRank.nickname),1)])),_:1})])),_:1}),f(x,{class:"item-starlight"},{default:c((()=>[f(d,{class:"star-icon"},{default:c((()=>[h("â­")])),_:1}),f(d,{class:"starlight-num"},{default:c((()=>[h(m(i.formatNumber(l.myRank.starlight)),1)])),_:1})])),_:1})])),_:1})])),_:1})):_("",!0)])),_:1})}],["__scopeId","data-v-617cdbbf"]]);export{x as default};
